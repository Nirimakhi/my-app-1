node{
   stage('SCM Checkout'){
      //Behind the scens it calls git groovy funcation with our arguments
    git credentialsId: 'git-Credentials',
       url: 'https://github.com/Nirimakhi/my-app-1',
       branch: 'master'
   }

stage('Maven package'){
 def mvnHome = tool name: 'maven3', type: 'maven'
//"${mvnHome}/bin/mvn" - complete path of maven where maven is installed
 def mvn ="${mvnHome}/bin/mvn"
 
//"${mvnHome} - string interpollation

 sh "${mvn} clean package"
}
   stage('Deploy -to Dev'){
     //remane the war file
     sh 'mv target/myweb*.war target/myweb.war'
     sshagent(['tomcat-dev']) {
     
     //stop the tomcat server
     ssh -o StrictHostKeyChecking=no ec2-user@172.31.11.19 /opt/tomcat8/bin/shutdown.sh
     
     //remove the old war file on tomcat
     ssh ec2-user@172.31.11.19 rm /opt/tomcat8/webapp/myweb*war
     
     //copy new war file on tomcat
     scp target/myweb.war ec2-user@172.31.11.19:/opt/tomca8/webapps/
     
     //strt tomcat
     ssh ec2-user@172.31.11.19 /opt/tomcat8/bin/startup.sh
} }
}
