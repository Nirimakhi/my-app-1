node{
   stage('SCM Checkout'){
      //Behind the scens it calls git groovy funcation with our arguments
    git credentialsId: 'git-Credentials',
       url: 'https://github.com/Nirimakhi/my-app-1',
       branch: 'master'
   }

stage('Maven package'){
 def mvnHome = tool name: 'maven3', type: 'maven'
//"${mvnHome}/bin/mvn" - complete path of maven where maven is installed
 def mvn ="${mvnHome}/bin/mvn"
 
//"${mvnHome} - string interpollation

 sh "${mvn} clean package"
}
   stage('Deploy-to-dev'){
 //rename the warfile
 sh 'mv target/myweb*war target/myweb.war'
 
  sshagent(['tomcat-dev']){
   def tomcatIp = '172.31.11.19'
   def tomcatUser = 'ec2-user'
   def stopTomcat = "${tomcatUser}@${tomcatIp} /opt/tomcat8/bin/shutdown.sh"
   def startTomcat = "${tomcatUser}@${tomcatIp} /opt/tomcat8/bin/startup.sh"
   def webApps = "/opt/tomcat8/webapps/"
   
   //Stop tomcat 
	 sh "ssh ${stopTomcat}"
	
   //Remove old war file on tomcat
	 sh "ssh ec2-user@172.31.11.19 rm /opt/tomcat8/webapps/myweb*"
	
   //copy new war file 
	  sh "scp target/myweb.war ${tomcatUser}@${tomcatIp}: ${webApps}"
	
   //start tomcat
	 sh " ssh ${startTomcat}"
	
  }
}
}
